{
  "name": "Liora WhatsApp Bot",
  "description": "Modern AI-powered WhatsApp bot with high-performance C++ addons for media processing",
  "version": "9.0.0-beta.3",
  "repository": "https://github.com/naruyaizumi/liora",
  
  "project_context": {
    "type": "WhatsApp Bot Framework",
    "architecture": "Hybrid (Node.js + C++ Native Addons)",
    "focus_areas": [
      "High-performance media processing (stickers, converters)",
      "Real-time WhatsApp automation using Baileys",
      "Async operations for better concurrency",
      "Memory-efficient with GC optimization"
    ],
    "performance_targets": {
      "media_processing": "< 500ms per operation",
      "memory_usage": "< 4GB max-old-space-size",
      "concurrent_operations": "Support multi-threaded async processing"
    }
  },

  "guidelines": [
    "Follow conventional commits format (feat:, fix:, docs:, chore:, perf:, refactor:, test:, ci:, build:)",
    "Use Prettier for all JS/JSON formatting (config in package.json)",
    "Use clang-format (Google style) for C++ code",
    "Write descriptive commit messages with scope: 'feat(sticker): add async processing'",
    "Add unit tests for critical features (media processing, API endpoints)",
    "Update README.md and inline docs when adding features",
    "For C++ changes: ensure no memory leaks and proper RAII patterns",
    "For performance changes: include benchmark data in PR description",
    "Keep dependencies minimal - prefer native Node.js APIs when possible",
    "Use ES modules syntax (import/export) consistently"
  ],

  "code_review_focus": [
    "Memory safety in C++ code (RAII, smart pointers, no raw pointers)",
    "Error handling (try-catch in C++, proper async error propagation in JS)",
    "Performance implications (avoid blocking operations, use async/await)",
    "Security concerns (input validation, buffer overflows, injection attacks)",
    "Breaking changes (API compatibility, data structure changes)",
    "Documentation completeness (JSDoc for public APIs, Doxygen for C++)",
    "Test coverage (especially for media processing edge cases)",
    "Resource cleanup (file handles, memory, threads)"
  ],

  "code_style": {
    "javascript": {
      "formatter": "prettier",
      "printWidth": 100,
      "tabWidth": 4,
      "useTabs": false,
      "semi": true,
      "singleQuote": false,
      "trailingComma": "es5",
      "arrowParens": "always",
      "endOfLine": "lf",
      "module_system": "ESM (import/export)",
      "naming_conventions": {
        "files": "kebab-case.js",
        "classes": "PascalCase",
        "functions": "camelCase",
        "constants": "UPPER_SNAKE_CASE",
        "private_methods": "_camelCase"
      },
      "best_practices": [
        "Use async/await over promises.then()",
        "Prefer const over let, avoid var",
        "Use optional chaining (?.) and nullish coalescing (??)",
        "Destructure imports for better tree-shaking",
        "Use import maps (#tiktok, #config, etc.) defined in package.json"
      ]
    },
    "cpp": {
      "formatter": "clang-format",
      "style": "Google",
      "standard": "C++20",
      "optimization_level": "O3 with LTO",
      "naming_conventions": {
        "files": "snake_case.cpp",
        "classes": "PascalCase",
        "functions": "camelCase or snake_case",
        "members": "snake_case_",
        "constants": "kConstantName"
      },
      "compiler_flags": {
        "optimization": ["-O3", "-flto=auto", "-funroll-loops", "-fomit-frame-pointer"],
        "warnings": ["-Wall", "-Wextra", "-Wno-deprecated-declarations"],
        "features": ["-std=c++20", "-fexceptions", "-pthread"],
        "linker": ["-Wl,--gc-sections", "-Wl,--as-needed"]
      },
      "best_practices": [
        "Use RAII for all resource management",
        "Prefer smart pointers (std::unique_ptr, std::shared_ptr) over raw pointers",
        "Use Napi::AsyncWorker for long-running operations",
        "Always handle Napi exceptions properly",
        "Use const correctness",
        "Avoid blocking the Node.js event loop",
        "Profile before optimizing (don't premature optimize)"
      ],
      "required_libraries": [
        "libwebp, libwebpmux, libwebpdemux (sticker generation)",
        "ffmpeg (libavformat, libavcodec, libavutil, libswresample, libswscale) (media conversion)",
        "pthread (multi-threading)",
        "node-addon-api (N-API wrapper)"
      ]
    }
  },

  "file_structure": {
    "src/": {
      "description": "Main application entry points",
      "key_files": {
        "index.js": "Bot entry point with --expose-gc and memory optimization",
        "config.js": "Configuration management (#config import)",
        "global.js": "Global utilities and helpers (#global import)"
      }
    },
    "lib/": {
      "description": "Library code and modules",
      "subdirs": {
        "api/": {
          "description": "External API integrations",
          "files": [
            "tiktok.js (#tiktok)",
            "instagram.js (#instagram)", 
            "twitter.js (#twitter)",
            "threads.js (#threads)",
            "play.js (#play)",
            "spotify.js (#spotify)",
            "ytmp3.js (#ytmp3)",
            "ytmp4.js (#ytmp4)",
            "spotifydl.js (#spotifydl)",
            "removebg.js (#removebg)",
            "remini.js (#remini)"
          ],
          "patterns": "Each API should handle rate limiting, error retry, and timeout"
        },
        "core/": {
          "description": "Core WhatsApp bot functionality",
          "files": [
            "message.js (#message) - Message handling",
            "socket.js (#socket) - WebSocket management",
            "connection.js (#connection) - Connection lifecycle"
          ]
        },
        "auth/": {
          "description": "Authentication and session management",
          "files": ["sqlite-auth.js (#auth) - SQLite-based auth state"]
        },
        "cpp/": {
          "description": "High-performance C++ native addons",
          "subdirs": {
            "core/": "Core C++ implementations (sticker_core.cpp, converter_core.cpp)",
            "bindings/": "N-API bindings (sticker.cpp, converter.cpp, *_async.cpp)"
          },
          "files": ["bridge-async.js (#add-on) - JS bridge to C++ async addons"],
          "build_targets": {
            "sticker_core": "Static library for sticker generation",
            "converter_core": "Static library for media conversion",
            "sticker": "Sync N-API binding for stickers",
            "converter": "Sync N-API binding for conversion",
            "sticker_async": "Async N-API binding (non-blocking)",
            "converter_async": "Async N-API binding (non-blocking)"
          },
          "performance_notes": "Prefer *_async versions for better concurrency"
        }
      }
    },
    "binding.gyp": {
      "description": "Node-gyp build configuration",
      "key_features": [
        "C++20 standard with aggressive optimization (O3, LTO)",
        "Static libraries for code reuse (sticker_core, converter_core)",
        "Separate sync/async bindings for flexibility",
        "FFmpeg and libwebp integration for media processing"
      ]
    }
  },

  "technologies": {
    "runtime": {
      "name": "Node.js",
      "version": ">=24.0.0",
      "flags": [
        "--expose-gc (manual GC control)",
        "--max-old-space-size=4096 (4GB heap)",
        "--trace-warnings (debugging)",
        "--trace-deprecation (API migration)"
      ]
    },
    "package_manager": "npm",
    "module_system": "ESM (type: module)",
    "whatsapp": {
      "library": "baileys@^7.0.0-rc.9",
      "description": "WhatsApp Web multi-device API"
    },
    "media_processing": {
      "canvas": "@napi-rs/canvas (Rust-based canvas for better performance)",
      "image": "sharp (high-performance image processing)",
      "audio": "audio-decode (audio file decoding)",
      "video": "ffmpeg via C++ bindings (libavformat, libavcodec)",
      "stickers": "Custom C++ addon (libwebp)"
    },
    "native_addons": {
      "builder": "node-gyp@^12.1.0",
      "api": "node-addon-api@^8.5.0 (N-API wrapper)",
      "language": "C++20",
      "compiler": "g++ or clang with C++20 support"
    },
    "database": {
      "auth": "better-sqlite3 (fast, embedded SQL for auth state)",
      "caching": "lru-cache (in-memory LRU cache)"
    },
    "concurrency": {
      "queue": "p-queue (promise-based queue with concurrency control)",
      "mutex": "async-mutex (async lock/semaphore)"
    },
    "logging": {
      "logger": "pino (fast JSON logger)",
      "pretty": "pino-pretty (development formatting)"
    },
    "utilities": {
      "file_watching": "chokidar (reliable file watcher)",
      "file_type": "file-type (magic number detection)",
      "env": "dotenv (environment variables)"
    }
  },

  "performance_considerations": {
    "memory": {
      "heap_limit": "4GB (--max-old-space-size=4096)",
      "gc_strategy": "Manual GC with --expose-gc for critical operations",
      "caching": "LRU cache for frequently accessed data",
      "recommendations": [
        "Use Buffer.allocUnsafe() for temp buffers (faster)",
        "Clear large objects after use to help GC",
        "Use streams for large files instead of loading into memory",
        "Monitor with process.memoryUsage() regularly"
      ]
    },
    "cpu": {
      "optimization": "C++ O3 + LTO for hot paths",
      "threading": "pthread for multi-core utilization in C++",
      "async": "Use async addons to avoid blocking event loop",
      "recommendations": [
        "Profile with perf or v8-profiler",
        "Use Worker Threads for CPU-intensive JS tasks",
        "Offload media processing to C++ async workers",
        "Use p-queue to limit concurrent operations"
      ]
    },
    "io": {
      "recommendations": [
        "Use async file operations (fs.promises)",
        "Batch database operations",
        "Use connection pooling for external APIs",
        "Implement rate limiting and backoff for API calls"
      ]
    }
  },

  "commit_conventions": {
    "types": {
      "feat": "New feature (e.g., feat(api): add instagram reel download)",
      "fix": "Bug fix (e.g., fix(sticker): memory leak in async worker)",
      "perf": "Performance improvement (e.g., perf(converter): optimize ffmpeg params)",
      "refactor": "Code refactoring without behavior change",
      "docs": "Documentation only (README, comments, JSDoc)",
      "style": "Code style/formatting (prettier, clang-format)",
      "test": "Adding or updating tests",
      "build": "Build system changes (binding.gyp, package.json)",
      "ci": "CI/CD changes (GitHub Actions workflows)",
      "chore": "Other changes (dependencies, configs)",
      "revert": "Revert previous commit"
    },
    "scopes": [
      "sticker", "converter", "api", "core", "auth", "config",
      "tiktok", "instagram", "twitter", "spotify", "youtube",
      "cpp", "bindings", "workflows", "deps"
    ],
    "examples": [
      "feat(sticker): add WebP optimization for smaller file sizes",
      "fix(api): handle rate limit errors in tiktok downloader",
      "perf(cpp): use SIMD instructions for image processing",
      "refactor(core): migrate to async message handling",
      "docs(readme): add installation guide for Debian",
      "ci(workflows): add cache for C++ build artifacts",
      "build(gyp): update ffmpeg library versions"
    ]
  },

  "testing_guidelines": {
    "unit_tests": {
      "focus": [
        "API endpoints (mock external APIs)",
        "Media processing (test with sample files)",
        "Error handling (test edge cases)",
        "Memory safety (C++ leak detection)"
      ],
      "tools": "Consider: vitest, jest, or node:test"
    },
    "integration_tests": {
      "focus": [
        "End-to-end message flow",
        "Multi-user scenarios",
        "Long-running stability"
      ]
    },
    "performance_tests": {
      "benchmarks": [
        "Sticker generation time (target: <500ms)",
        "Concurrent operation throughput",
        "Memory usage under load"
      ],
      "tools": "Consider: autocannon, clinic.js, 0x (flamegraphs)"
    }
  },

  "security_considerations": {
    "input_validation": [
      "Sanitize all user inputs (URLs, file paths, commands)",
      "Validate file types using magic numbers (file-type)",
      "Limit file sizes to prevent DoS",
      "Escape shell commands (avoid command injection)"
    ],
    "dependency_security": [
      "Regular npm audit and fixes",
      "Pin critical dependency versions",
      "Review dependencies for supply chain attacks",
      "Use Dependabot for automated updates"
    ],
    "c_cpp_security": [
      "Prevent buffer overflows (use std::vector, std::string)",
      "Validate buffer sizes before operations",
      "Use AddressSanitizer during development",
      "No use-after-free (RAII, smart pointers)"
    ]
  },

  "debugging_tips": {
    "javascript": {
      "memory_leaks": "node --inspect + Chrome DevTools heap profiler",
      "cpu_profiling": "node --prof or clinic flame",
      "tracing": "--trace-warnings --trace-deprecation flags"
    },
    "cpp": {
      "memory_leaks": "valgrind --leak-check=full",
      "sanitizers": "Compile with -fsanitize=address,undefined",
      "gdb": "Use gdb for segfaults and crashes",
      "logging": "Add verbose logging with conditional compilation"
    },
    "performance": {
      "node": "clinic doctor, clinic flame, clinic bubbleprof",
      "cpp": "perf record + perf report, gprof, cachegrind"
    }
  },

  "contribution_workflow": {
    "steps": [
      "1. Fork repo and create feature branch (feat/my-feature)",
      "2. Make changes following code style guidelines",
      "3. Run prettier and clang-format before committing",
      "4. Write descriptive commit messages (conventional commits)",
      "5. Test thoroughly (manual + automated if available)",
      "6. Push and create PR with clear description",
      "7. Address review feedback promptly",
      "8. Squash commits before merge if needed"
    ],
    "pr_template": {
      "title": "Type(scope): brief description",
      "sections": [
        "## Description - What and why",
        "## Changes - Detailed list of changes",
        "## Testing - How to test",
        "## Performance - Benchmarks if applicable",
        "## Breaking Changes - List any breaking changes",
        "## Related Issues - Link to issues"
      ]
    }
  },

  "ai_assistant_hints": {
    "when_reviewing_code": [
      "Check for memory leaks in C++ (RAII patterns)",
      "Verify async operations don't block event loop",
      "Ensure error handling is comprehensive",
      "Look for performance bottlenecks (unnecessary copies, allocations)",
      "Validate input sanitization for security",
      "Check that imports use the import maps (#tiktok, etc.)"
    ],
    "when_suggesting_improvements": [
      "Prefer async/await over callbacks",
      "Suggest using existing utilities before adding dependencies",
      "Recommend profiling before optimizing",
      "Point out potential memory leaks or race conditions",
      "Suggest appropriate caching strategies",
      "Recommend security best practices"
    ],
    "when_generating_code": [
      "Use ES modules (import/export)",
      "Follow existing code style (prettier config)",
      "Add JSDoc comments for public APIs",
      "Handle errors gracefully with try-catch",
      "Use import maps for internal modules",
      "For C++: use N-API properly, RAII, smart pointers"
    ]
  }
}