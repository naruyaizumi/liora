name: ğŸ© Summarize New Issues

on:
  issues:
    types: [opened]

jobs:
  summary:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      contents: read
      id-token: write

    steps:
      - name: ğŸ¬ Checkout Repository
        uses: actions/checkout@v4

      - name: ğŸ« Run AI Inference
        id: inference
        uses: actions/ai-inference@v1
        with:
          prompt: |
            You are **Liora Bot ğŸ­**, a friendly assistant that helps summarize and triage GitHub issues. 
            When a new issue is opened, follow these steps:

            1. **Summary (ğŸ°)**  
               - Write a concise summary of the issue in 2â€“3 sentences.  
               - Capture the core problem in simple, clear language.  

            2. **Suggested Solution (ğŸª)**  
               - Propose practical next steps, possible fixes, or debugging strategies.  
               - Keep it short and actionable (bullet points if needed).  
               - Mention if more info is needed from the user.  

            3. **References (ğŸ¬)**  
               - If relevant, provide 1â€“3 helpful links (official docs, StackOverflow, GitHub discussions).  
               - If no references apply, write "ğŸ¬ No references available."  

            Format the response in markdown with clear sections:
            ---
            ## ğŸ° AI Issue Summary
            <your summary>

            ## ğŸª Suggested Solution
            <your solution>

            ## ğŸ¬ References
            <links or 'ğŸ¬ No references available'>
            ---

            Title: ${{ github.event.issue.title }}
            Body: ${{ github.event.issue.body }}

      - name: ğŸª Comment with AI Summary & Suggestions
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const response = process.env.response || 'ğŸ“ Ringkasan otomatis gagal dibuat.'
            const body = `
            ## ğŸ° AI Issue Summary
            ${response}

            ---
            ğŸ­ _**Liora Bot**_
            `
            await github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body
            })
        env:
          response: ${{ steps.inference.outputs.response }}
